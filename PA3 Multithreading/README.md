# Project 3 : Multithreading
### Project Group Number: 41
### Group members: Michael Spiese (spies046), Jack Vehmeier (vehme003), Isaac Hein (hein0540) 
### Test Machine: csel-kh4250-49 

## Extra Task
Our group was able to implement the extra task of a bounded buffer for the shared queue.
A linked-list structure was used in combination with an extra semaphore initialized to
the intended queue size in order to keep track of packets in the queue. To use the bounded 
buffer, the "-b" or "-bp" flags can be set and the size of the queue can be specified 
at the command line before execution.

## Individual Contributions
For individual contributions, Jack primarily helped with general debugging and running test cases, Isaac primarily handled the parsing code and general
lock structure, and Michael primarily handled the semaphore implementation as well as the spawning of the producer and consumers. 
All contributions were then combined together remotely as a group.

## Assumptions
Outside of those in the manual, we also assumed the maximum length of any line in the .csv file has a length 
less than or equal to the chunkSize macro defined in "utils.h"

## Compiling the Program
Compilation of the program was done with a Makefile. First, to ensure the executable program files
are up to date, the following terminal command removes all object files and executables from the
current directory:

	> make clean
	
The "make clean" command is analogous to running the following terminal command:

	> rm bank main.o producer.o consumer.o lib/utils.o

Next, to compile all source files into the files needed to run the program, the following command is used:

	> make
	
The "make" command is analagous to running the following terminal commands in order:
	
	> gcc -o lib/utils.o -Iinclude -c lib/utils.c -g
	> gcc -o main.o -Iinclude -c src/main.c -g
	> gcc -o producer.o -Iinclude -c src/producer.c -g
	> gcc -o consumer.o -Iinclude -c src/consumer.c -g
	> gcc -o bank main.o producer.o consumer.o lib/utils.o -Iinclude -g -lpthread

## Execution
Finally, to execute the program with a single input file, one of the following commands is used:

	> make t1
	> make t2
	...
	> make t5
	
The "make t[1-5]" command is split into two parts. The first one is the bank function which can be written in the terminal with the ./bank command:

	> ./bank [# consumers] [input filepath]  {flags} {queue size}

Each ./bank command searches for, opens, and parses through the specific .csv file and writes the final balance results to a file (results.txt). In this
command, the number of consumer threads to generate and the input file path must be specified. However, there are also a couple optional argumets than can
be given as well. First, the flags "-p", "-b", or "-bp" can be given which tell the program to generate a log file, use a bounded buffer for the shared 
queue, or generate a log file and use a bounded buffer for the shared queue respecfully. The second optional argument specifies the size of the bounded
buffer if the "-b" or "-bp" flag has been given.

Each of the make t[1-5] commands also has a built in compare function that compares the results.txt generated by the bank command to a file that was 
given to us in the expected folder. It should contain the correct final balances of all of the customers corresponding to their customer ID. It compares 
the two txt files with the built in command diff which then echos the word "passed" if the diff does not find any differences in the two .txts. This is 
represented by the following terminal commands: 

	> diff expected/results[1-5].txt output/result.txt
	> @echo passed


So all together individual make t[1-5] calls would be analagous to the following terminal commands in order:

	> make t1
	> ./bank 1 input/t1.csv 
	> diff expected/results1.txt output/result.txt
	> @echo passed

	> make t2
	> ./bank 100 input/t2.csv
	> diff expected/results2.txt output/result.txt
	> @echo passed

	> make t3
	> ./bank 100 input/t3.csv
	> diff expected/results3.txt output/result.txt
	> @echo passed

	> make t4
	> ./bank 100 input/t4.csv
	> diff expected/results4.txt output/result.txt
	> @echo passed

	> make t5
	> ./bank 100 input/t5.csv
	> diff expected/results5.txt output/result.txt
	> @echo passed 

To automatically execute all of these programs sequentially, write to the output file, and compare their 
results, the following command can be used:

	> make test

The "make test" command is analagous to running the following terminal commands in order:

	> ./bank 1 input/t1.csv 
	> diff expected/results1.txt output/result.txt
	> @echo passed
	> ./bank 100 input/t2.csv
	> diff expected/results2.txt output/result.txt
	> @echo passed
	> ./bank 100 input/t3.csv
	> diff expected/results3.txt output/result.txt
	> @echo passed
	> ./bank 100 input/t4.csv
	> diff expected/results4.txt output/result.txt
	> @echo passed
	> ./bank 100 input/t5.csv
	> diff expected/results5.txt output/result.txt
	> @echo passed 


It is important to note that "make test" call only will keep running if the diff command does not find any differences. If there is a difference it will 
exit and not continue running the next commands. Also running "make test" or any "make t[1-5]" followed by another "make t[1-5]" will not save the generated 
results.txt from previous runs. The results.txt will constantly be overwritten and will correspond to the final test case's output file after execution.

## Results
Results output to the terminal, via the "make test" command. It should run through every case and then echo the word passed before moving on to the next 
case. It is possible to also view the individual results.txt files by running the individual "make t[1-5]" commands and viewing them in the output 
directory. Additionally, if the flag is set, a log file called log.txt will be created in the output directory that shows thread spawning and program 
execution information. The output files will be generated in the following form:

	output/results.txt:
	0		[Customer 0 balance change]
	1		[Customer 1 balance change]
	2		[Customer 2 balance change]
	...		...
	999		[Customer 999 balance change]
	All:	[Sum of all balance changes]
	
	
	output/log.txt:
	producer
	consumer 0
	consumer 1
	...
	producer: line 0
	producer: line 1
	...
	consumer [consumerID]: line 0
	consumer [consumerID]: line 1
	...
	producer: line -1
	...
	consumer [consumerID]: line -1
	consumer [consumerID]: line -1

